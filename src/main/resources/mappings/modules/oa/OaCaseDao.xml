<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="gov.kl.chengguan.modules.oa.dao.OaCaseDao">
	
    <sql id="caseColumns">
		a.*,
		a.parties as "caseParties",
		a.legal_agent as "caseLegalAgent",
		a.case_desc as "caseDescription",
		u.id AS "createBy.id",
		u.name AS "createBy.name",
		o.id AS "publisher.office.id",
		o.name AS "publisher.office.name" 
	</sql>
	
	<sql id="caseJoins">
		JOIN sys_user u ON u.id = a.create_by
		JOIN sys_office o ON o.id = u.office_id
    </sql>
	
	<insert id="insert">
		INSERT INTO oa_case(
			id,
		title,
			parties,
			legal_agent,
			address,
			phone_number,
			case_desc,
		case_check_flag,
			case_check_result,
	case_docs,
	case_imgs,
	case_videos,
	case_thumbnails,
			case_source,
			assigneeIds,
			norm_desc_Part1,
			norm_desc_Part2,
		illegal_construct_flag,
			institution_reg_opt,
			institution_reg_flag,
			deptLeader_reg_opt,
			deptLeader_reg_flag,
			mainLeader_reg_opt,
			mainLeader_reg_flag,
			caseRegStartDate,
			caseRegEndDate,
			caseSurveyEndDate,
			norm_penal_Part1,
			norm_penal_Part2,
			assignee_penal_opt,
		doc_no,
			institution_penal_opt,
			institution_penal_flag,
			caseMgtCenter_penal_opt,
			caseMgtCenter_penal_flag,
			deptLeader_penal_opt,
			deptLeader_penal_flag,
			mainLeader_penal_opt,
			mainLeader_penal_flag,
			casePenalStartDate,
			casePenalEndDate,
			assignee_close_case_opt,
			institution_close_opt,
			institution_close_flag,
			caseMgtCenter_close_opt,
			caseMgtCenter_close_flag,		
			mainLeader_close_opt,
			mainLeader_close_flag,
			caseCloseUpStartDate,
			caseCloseUpEndDate,
			case_stage,
			proc_ins_id,
			create_by,
			create_date,
			update_by,
			update_date,
			remarks,
			del_flag			
		) VALUES (
			#{id}, 
		#{title},
			#{caseParties},
			#{caseLegalAgent},
			#{address},
			#{phoneNumber},
			#{caseDescription},
		#{caseCheckFlag},
			#{caseCheckResult},
	#{caseDocuments},
	#{caseImages},	
	#{caseVideos},	
	#{caseThumbnails},
			#{caseSource},
			#{assigneeIds},
			#{normCaseDescPart1},
			#{normCaseDescPart2},
		#{illegalConstructionFlag},
			#{institutionRegOption},
			#{institutionRegApproval},
			#{deptLeaderRegOption},
			#{deptLeaderRegApproval},
			#{mainLeaderRegOption},
			#{mainLeaderRegApproval},
			#{caseRegStartDate},
			#{caseRegEndDate},
			#{caseSurveyEndDate},
			#{normAssigneePenalOptPart1},
			#{normAssigneePenalOptPart2},
			#{assigneePenalOption},
		#{caseDocNo},
			#{institutionPenalOption},
			#{institutionPenalApproval},
			#{caseMgtCenterPenalOption},
			#{caseMgtCenterPenalApproval},
			#{deptLeaderPenalOption},
			#{deptLeaderPenalApproval},
			#{mainLeaderPenalOption},
			#{mainLeaderPenalApproval},
			#{casePenalStartDate},
			#{casePenalEndDate},
			#{assigneeCloseCaseOption},
			#{institutionCloseCaseOption},
			#{institutionCloseCaseApproval},
			#{caseMgtCenterCloseCaseOption},
			#{caseMgtCenterCloseCaseApproval},
			#{mainLeaderCloseCaseOption},
			#{mainLeaderCloseCaseApproval},
			#{caseCloseUpStartDate},
			#{caseCloseUpEndDate},
			#{caseStage},
			#{processInstanceId},
			#{createBy.id}, 
			#{createDate}, 
			#{updateBy.id}, 
			#{updateDate}, 
			#{remarks},
			#{delFlag}
		)
	</insert>
	
	<update id="update">
		UPDATE oa_case SET 
			parties = #{caseParties},
		title = #{title},
			legal_agent = #{caseLegalAgent},
			address = #{address},
			phone_number = #{phoneNumber},
			case_desc = #{caseDescription},
		case_check_flag = #{caseCheckFlag},
			case_check_result = #{caseCheckResult},
	case_docs = #{caseDocuments},
	case_imgs = #{caseImages},	
	case_videos = #{caseVideos},
	case_thumbnails = #{caseThumbnails},
			case_source = #{caseSource},
			assigneeIds = #{assigneeIds},
			norm_desc_Part1 = #{normCaseDescPart1},
			norm_desc_Part2 = #{normCaseDescPart2},
		illegal_construct_flag = #{illegalConstructionFlag},
			institution_reg_opt = #{institutionRegOption},
			institution_reg_flag = #{institutionRegApproval},
			deptLeader_reg_opt = #{deptLeaderRegOption},
			deptLeader_reg_flag = #{deptLeaderRegApproval},
			mainLeader_reg_opt = #{mainLeaderRegOption},
			mainLeader_reg_flag = #{mainLeaderRegApproval},
			caseRegStartDate = #{caseRegStartDate},
			caseRegEndDate = #{caseRegEndDate},
			caseSurveyEndDate = #{caseSurveyEndDate},
			norm_penal_Part1 = #{normAssigneePenalOptPart1},
			norm_penal_Part2 = #{normAssigneePenalOptPart2},
			assignee_penal_opt = #{assigneePenalOption},
		doc_no = #{caseDocNo},
			institution_penal_opt = #{institutionPenalOption},
			institution_penal_flag = #{institutionPenalApproval},
			caseMgtCenter_penal_opt = #{caseMgtCenterPenalOption},
			caseMgtCenter_penal_flag = #{caseMgtCenterPenalApproval},					
			deptLeader_penal_opt = #{deptLeaderPenalOption},
			deptLeader_penal_flag = #{deptLeaderPenalApproval},
			mainLeader_penal_opt = #{mainLeaderPenalOption},
			mainLeader_penal_flag = #{mainLeaderPenalApproval},
			casePenalStartDate = #{casePenalStartDate},
			casePenalEndDate = #{casePenalEndDate},
			assignee_close_case_opt = #{assigneeCloseCaseOption},
			institution_close_opt = #{institutionCloseCaseOption},
			institution_close_flag = #{institutionCloseCaseApproval},
			caseMgtCenter_close_opt = #{caseMgtCenterCloseCaseOption},
			caseMgtCenter_close_flag = #{caseMgtCenterCloseCaseApproval},	
			mainLeader_close_opt = #{mainLeaderCloseCaseOption},
			mainLeader_close_flag = #{mainLeaderCloseCaseApproval},
			caseCloseUpStartDate = #{caseCloseUpStartDate},
			caseCloseUpEndDate = #{caseCloseUpEndDate},
			case_stage = #{caseStage}
		WHERE id = #{id}
	</update>
		
	<update id="updateProcessInstanceId">
		UPDATE oa_case SET 
			proc_ins_id = #{processInstanceId}
		WHERE id = #{id}
	</update>
	
	<update id="updateCaseCheckResult">
		UPDATE oa_case SET 
			case_check_flag = #{caseCheckFlag},
			case_check_result = #{caseCheckResult},			
			case_stage = #{caseStage},
			update_by = #{updateBy.id}, 
			update_date = #{updateDate}
		WHERE id = #{id}
	</update>
	
	<update id="updateCaseRecord">
		UPDATE oa_case SET 
		title = #{title},
	case_docs = #{caseDocuments},
	case_imgs = #{caseImages},	
	case_videos = #{caseVideos},
	case_thumbnails = #{caseThumbnails},
			case_source = #{caseSource},
			assigneeIds = #{assigneeIds}, 
			norm_desc_Part1 = #{normCaseDescPart1},
			norm_desc_Part2 = #{normCaseDescPart2},
		illegal_construct_flag = #{illegalConstructionFlag},
			update_by = #{updateBy.id}, 
			update_date = #{updateDate}
		WHERE id = #{id}
	</update>
			
	<update id="updateInstitutionRegOption">
		UPDATE oa_case SET 
			institution_reg_opt = #{institutionRegOption},
			institution_reg_flag = #{institutionRegApproval},
			update_by = #{updateBy.id}, 
			update_date = #{updateDate}
		WHERE id = #{id}
	</update>
	
	<update id="updateDeptLeaderRegOption">
		UPDATE oa_case SET 
			deptLeader_reg_opt = #{deptLeaderRegOption},
			deptLeader_reg_flag = #{deptLeaderRegApproval},
			update_by = #{updateBy.id}, 
			update_date = #{updateDate}
		WHERE id = #{id}
	</update>

	<update id="updateMainLeaderRegOption">
		UPDATE oa_case SET 
			mainLeader_reg_opt = #{mainLeaderRegOption},
			mainLeader_reg_flag = #{mainLeaderRegApproval},
			caseRegEndDate = #{caseRegEndDate},
			update_by = #{updateBy.id}, 
			update_date = #{updateDate}
		WHERE id = #{id}
	</update>

	<update id="updateCaseDesc">
		UPDATE oa_case SET 
			case_desc = #{caseDescription},
			norm_desc_Part1 = #{normCaseDescPart1},
			norm_desc_Part2 = #{normCaseDescPart2},
			update_by = #{updateBy.id}, 
			update_date = #{updateDate}
		WHERE id = #{id}
	</update>
	
	<update id="updateCaseAttachmentLinks">
		UPDATE oa_case SET 
		case_docs = #{caseDocuments},
		case_imgs = #{caseImages},	
		case_videos = #{caseVideos},
		case_thumbnails = #{caseThumbnails},
			case_stage = #{caseStage},
			update_by = #{updateBy.id}, 
			update_date = #{updateDate}
		WHERE id = #{id}
	</update>
		
	<update id="updateCasePenal">
		UPDATE oa_case SET 
			norm_penal_Part1 = #{normAssigneePenalOptPart1},
			norm_penal_Part2 = #{normAssigneePenalOptPart2},
			assignee_penal_opt = #{assigneePenalOption},
			update_by = #{updateBy.id}, 
			update_date = #{updateDate}
		WHERE id = #{id}
	</update>

	<update id="updateAssigneePenalOption">
		UPDATE oa_case SET 
			assignee_penal_opt = #{assigneePenalOption},
			case_stage = #{caseStage},			
			update_by = #{updateBy.id}, 
			doc_no = #{caseDocNo},
			update_date = #{updateDate}
		WHERE id = #{id}
	</update>
		
	<update id="updateInstitutionPenalOption">
		UPDATE oa_case SET 
			institution_penal_opt = #{institutionPenalOption},
			institution_penal_flag = #{institutionPenalApproval},
			update_by = #{updateBy.id}, 
			update_date = #{updateDate}
		WHERE id = #{id}
	</update>
	
	<update id="updateMgtCenterPenalOption">
		UPDATE oa_case SET 
			caseMgtCenter_penal_opt = #{caseMgtCenterPenalOption},
			caseMgtCenter_penal_flag = #{caseMgtCenterPenalApproval},				
			update_by = #{updateBy.id}, 
			update_date = #{updateDate}
		WHERE id = #{id}
	</update>
	
	<update id="updateDeptLeaderPenalOption">
		UPDATE oa_case SET 
			deptLeader_penal_opt = #{deptLeaderPenalOption},
			deptLeader_penal_flag = #{deptLeaderPenalApproval},
			update_by = #{updateBy.id}, 
			update_date = #{updateDate}
		WHERE id = #{id}
	</update>
	
	<update id="updateMainLeaderPenalOption">
		UPDATE oa_case SET 
			mainLeader_penal_opt = #{mainLeaderPenalOption},
			mainLeader_penal_flag = #{mainLeaderPenalApproval},
			casePenalEndDate = #{casePenalEndDate},	
			update_by = #{updateBy.id}, 
			update_date = #{updateDate}
		WHERE id = #{id}
	</update>
	
	<update id="updateAssigneeCloseOption">
		UPDATE oa_case SET 
			assignee_close_case_opt = #{assigneeCloseCaseOption},
			caseCloseUpStartDate = #{caseCloseUpStartDate},
			case_stage = #{caseStage},
			update_by = #{updateBy.id}, 
			update_date = #{updateDate}
		WHERE id = #{id}
	</update>
	
	<update id="updateInstitutionCloseOption">
		UPDATE oa_case SET 
			institution_close_opt = #{institutionCloseCaseOption},
			institution_close_flag = #{institutionCloseCaseApproval},
			update_by = #{updateBy.id}, 
			update_date = #{updateDate}
		WHERE id = #{id}
	</update>
	
	<update id="updateMgtCenterCloseOption">
		UPDATE oa_case SET 
			caseMgtCenter_close_opt = #{caseMgtCenterCloseCaseOption},
			caseMgtCenter_close_flag = #{caseMgtCenterCloseCaseApproval},	
			update_by = #{updateBy.id}, 
			update_date = #{updateDate}
		WHERE id = #{id}
	</update>
	
	<update id="updateMainLeaderCloseOption">
		UPDATE oa_case SET 
			mainLeader_close_opt = #{mainLeaderCloseCaseOption},
			mainLeader_close_flag = #{mainLeaderCloseCaseApproval},
			caseCloseUpEndDate = #{caseCloseUpEndDate},
			update_by = #{updateBy.id}, 
			update_date = #{updateDate}
		WHERE id = #{id}
	</update>
	

	<update id="delete">
		UPDATE oa_case SET 
			del_flag = #{DEL_FLAG_DELETE}
		WHERE id = #{id}
	</update>

    
    <select id="get" resultType="OaCase">
		SELECT 
			<include refid="caseColumns"/>
		FROM oa_case a
			<include refid="caseJoins"/>
		WHERE a.id = #{id}
	</select>
	
	<select id="findList" resultType="OaCase">
		SELECT 
			<include refid="caseColumns"/>
		FROM oa_case a
			<include refid="caseJoins"/>
		WHERE a.del_flag = #{DEL_FLAG_NORMAL} 
		<if test="caseQueryTitle != null and caseQueryTitle != ''" >
			AND a.caseTitle LIKE
				<if test="dbName == 'mysql'">CONCAT('%', #{caseQueryTitle}, '%')</if>
				<if test="dbName == 'oracle'">'%'||#{caseQueryTitle}||'%'</if>
				<if test="dbName == 'mssql'">'%'+#{caseQueryTitle}+'%'</if>
		</if>
		<if test="caseQueryDocNo != null and caseQueryDocNo != ''" >
			AND a.caseDocNo LIKE
				<if test="dbName == 'mysql'">CONCAT('%', #{caseQueryDocNo}, '%')</if>
				<if test="dbName == 'oracle'">'%'||#{caseQueryDocNo}||'%'</if>
				<if test="dbName == 'mssql'">'%'+#{caseQueryDocNo}+'%'</if>
		</if>
		<if test="caseQueryParty != null and caseQueryParty != ''" >
			AND a.parties LIKE
				<if test="dbName == 'mysql'">CONCAT('%', #{caseQueryParty}, '%')</if>
				<if test="dbName == 'oracle'">'%'||#{caseQueryParty}||'%'</if>
				<if test="dbName == 'mssql'">'%'+#{caseQueryParty}+'%'</if>
		</if>
		<if test="caseQueryLegalAgent != null and caseQueryLegalAgent != ''">
			AND a.legal_agent LIKE 
				<if test="dbName == 'mysql'">CONCAT('%', #{caseQueryLegalAgent}, '%')</if>
				<if test="dbName == 'oracle'">'%'||#{caseQueryLegalAgent}||'%'</if>
				<if test="dbName == 'mssql'">'%'+#{caseQueryLegalAgent}+'%'</if>
		</if>
		<if test="caseQueryAddress != null and caseQueryAddress != ''">
			AND a.address LIKE
				<if test="dbName == 'mysql'">CONCAT('%', #{caseQueryAddress}, '%')</if>
				<if test="dbName == 'oracle'">'%'||#{caseQueryAddress}||'%'</if>
				<if test="dbName == 'mssql'">'%'+#{caseQueryAddress}+'%'</if>
		</if>	
		<if test="caseQueryPhoneNumber != null and caseQueryPhoneNumber != ''">
			AND a.phone_number LIKE
				<if test="dbName == 'mysql'">CONCAT('%', #{caseQueryPhoneNumber}, '%')</if>
				<if test="dbName == 'oracle'">'%'||#{caseQueryPhoneNumber}||'%'</if>
				<if test="dbName == 'mssql'">'%'+#{caseQueryPhoneNumber}+'%'</if>			
		</if>
		<if test="caseQueryAssignee != null">
			AND a.assigneeIds LIKE
				<if test="dbName == 'mysql'">CONCAT('%', #{caseQueryAssignee.id}, '%')</if>
				<if test="dbName == 'oracle'">'%'||#{caseQueryAssignee.id}||'%'</if>
				<if test="dbName == 'mssql'">'%'+#{caseQueryAssignee.id}+'%'</if>	
		</if>
		<if test="caseQueryIllegalConstruct != null">
			AND a.illegal_construct_flag = #{caseQueryIllegalConstruct}
		</if>
		<if test="caseQueryStage >= null">
			AND a.case_stage = #{caseQueryStage}
		</if>			
		<if test="caseQueryBrokeLaw != null and caseQueryBrokeLaw != ''">
			AND a.norm_desc_Part2 = #{caseQueryBrokeLaw}
		</if>	
		<if test="caseQueryPenal != null">
			AND a.norm_penal_Part2 &gt;= #{caseQueryPenal}
		</if>	
		<if test="caseQueryRegStartDateStart != null">
			AND a.caseRegStartDate &gt;= #{caseQueryRegStartDateStart}
		</if>
		<if test="caseQueryRegStartDateEnd != null">
			AND a.caseRegStartDate &gt;= #{caseQueryRegStartDateEnd}
		</if>
		<if test="caseQueryRegEndDateStart != null">
			AND a.caseRegEndDate &gt;= #{caseQueryRegEndDateStart}
		</if>									
		<if test="caseQueryRegEndDateEnd != null">
			AND a.caseRegEndDate &gt;= #{caseQueryRegEndDateStart}
		</if>
		<if test="caseQueryCloseDateStart != null">
			AND a.caseCloseUpEndDate &lt;= #{caseQueryCloseDateStart}
		</if>
		<if test="caseQueryCloseDateEnd != null">
			AND a.caseCloseUpEndDate &lt;= #{caseQueryCloseDateEnd}
		</if>		
		${sqlMap.dsf}
		ORDER BY a.id DESC
	</select>
	
	<select id="findAllList" resultType="OaCase">
		SELECT 
			<include refid="caseColumns"/>
		FROM oa_case a
			<include refid="caseJoins"/>
		WHERE a.del_flag = #{DEL_FLAG_NORMAL} 
		ORDER BY a.id DESC
	</select>	
	
</mapper>